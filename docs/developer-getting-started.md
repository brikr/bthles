# Developer Getting Started

## Helpful documentation
- [Angular](https://angular.io/docs)
- [Firebase](https://firebase.google.com/docs/)
- [@angular/fire](https://github.com/angular/angularfire2)
- [Angular Material](https://material.angular.io)

## 0. Prerequisites
bthl.es is powered by Angular and Firebase. You will need the CLI tools for both.
- [Angular CLI](https://cli.angular.io/)
- [Firebase Tools](https://github.com/firebase/firebase-tools)

## 1. Firebase setup
1. Create a new project in the [Firebase Console](https://console.firebase.google.com). Don't worry about incurring costs; the default "Spark" plan allows plenty of usage and doesn't require a billing account to use.
1. Navigate to the **Authentication** page under the **Develop** section of the left navigation. Select **Sign-in method**, then enable **Anonymous** authentication. Save your changes. The [database rules](../firestore.rules) require auth to read/create any fields. This allows us to keep track of the owner of links, even when users aren't authenticated through a third party service.
1. Navigate to the **Database** page under the **Develop** section of the left navigation. Select **Create database** to create the Firestore database that the application will use. You can start in locked or test mode, as we will update the rules very soon.
1. Run `firebase login` and follow the steps to authenticate your Firebase CLI tools.
1. Run `firebase use --add` and select your newly created project. You can give it any alias.
1. Run `firebase deploy --only functions,firestore` to deploy the Cloud Functions and Firestore indexes/rules.

## 2. Angular setup
1. From the project overview page in the [Firebase console](https://console.firebase.google.com), click **Add Firebase to your web app**. Note the code snippet shown, we will use it in the next step.
1. Copy `src/environments/environment.sample.ts` to a new file named `environment.ts` in the same directory. Fill out the fields in the `firebase` object with the data from the code snippet in the previous step. The Angular project will use these values to connect to your database. *If necessary, it's safe to check this configuration into source control (this is the same API key etc. that your bundled and deployed application will use).*
1. *Optional:* Create another copy of `environment.sample.ts` named `environment.staging.ts` and update the `baseUrl` field to be `https://<your-firebase-project>.firebaseapp.com`
1. Run `npm install` to acquire all third party libraries used by the Angular application.

## Serving locally
Once you've performed the above steps, you can run `ng serve` to serve the application locally. Access it at http://localhost:4200. Once you've created your first link, you can view the contents of the database in the Firebase console and you'll see two collections created: `meta` and `links`. The former stores metadata about the database (currently only the `nextUrl` value), while `links` stores all of the created `links`. *Note: you might notice some function errors in your Firebase console after creating your first link. The frontend and backend both have some checks in place to retry creating nextUrl so that it ends up working for the end user even if there are some oddities in the database, which means some errors might pop up at the very beginning. If these errors persist into future link creation while developing, please [create an issue](https://github.com/brikr/bthles/issues/new).*

At this point, you're ready to start making and testing changes to the application!

## Deploying to Firebase hosting
1. If you haven't created `environment.staging.ts` from **2. Angular setup**, do so now.
1. Run `ng build -c staging` to build the distributable bundle.
1. Run `firebase deploy` to deploy all targets (functions, Firestore, and hosting)

Your app is deployed! The previous command outputs the URL you can access it at: `https://<your-firebase-project>.firebaseapp.com`. By using the `staging` configuration when building your Angular app, the `baseUrl` was properly replaced and links generated by the deployed version will be based off of its URL.
